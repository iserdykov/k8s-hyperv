# Kubernetes Cluster on Hyper-V

Practice real Kubernetes configurations on a local multi-node cluster.

Tested on: PowerShell 5.1 on Windows 10 Pro 1903, guest images Ubuntu 18.04 and 19.04.

Start by reading the [hyper-v.ps1](hyper-v.ps1) script.

## Example usages:

```powershell

# Prepare the image
$vhdxtmpl = prepare-vhdx-tmpl -url `
  'http://cloud-images.ubuntu.com/releases/server/18.04/release/ubuntu-18.04-server-cloudimg-amd64.img'

# 1. create switch/network
create-public-net -switch 'switch' -adapter 'Wi-Fi'
# --or--
create-private-net -natnet 'natnet' -switch 'switch' -cblock '192.168.0'

# use with public net DHCP, preserve the MACs across VM deletes
# (fill in your MAC addresses generated by calling create-mac-address)
# mac1 = ''
# mac2 = ''
# mac3 = ''

# 2. create machines (for DHCP use -cblock $null -ip $null -mac your_saved_mac_address)
create-machine -switch 'switch' -vmname 'master' -cpus 4 -mem 4GB -hdd 40GB `
    -vhdxtmpl $vhdxtmpl -cblock '192.168.0' -ip '10' #-mac mac1
create-machine -switch 'switch' -vmname 'node1' -cpus 4 -mem 4GB -hdd 40GB `
    -vhdxtmpl $vhdxtmpl -cblock '192.168.0' -ip '11' #-mac mac2
create-machine -switch 'switch' -vmname 'node2' -cpus 4 -mem 4GB -hdd 40GB `
    -vhdxtmpl $vhdxtmpl -cblock '192.168.0' -ip '12' #-mac mac3

# 3. open Hyper-V manager, and wait until all VMs are auto-stopped,
#    then start them again (select "Continue"), and you can SSH into them

# 4. optionally, update /etc/hosts so you can e.g. `ssh user@master`
update-etc-hosts -cblock '192.168.0'

# 5. when done, delete machines
delete-machine -name 'minion2'
delete-machine -name 'minion1'
delete-machine -name 'master'

# 6. when done, delete switch/network
delete-public-net -switch 'switch'
# --or--
delete-private-net -switch 'switch' -natnet 'natnet'

# example scripting:
# (if w/o exclusive master: kubectl taint nodes node1 node-role.kubernetes.io/master-)
$num = 6
create-nodes($num)
delete-nodes($num)

```
